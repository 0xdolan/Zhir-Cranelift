@page
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}

<form asp-controller="Ocr" asp-action="Post"
      enctype="multipart/form-data" onsubmit="AJAXSubmit(this);return false;"
      method="post">

    <div class="alert alert-info" role="alert">
        <b>Note:</b> ZhirAI is in early beta phase. The final product will be more accurate, reliable, and user friendly!
    </div>

    <div class="form-group">
        <label for="imageFiles">Please select an image to be scanned (Or drag and drop the image below):</label>
        <input name="imageFiles" class="form-control" type="file" style="padding:10px;height:50px" />
    </div>

    <input class="btn btn-primary btn-lg col-4 offset-4" type="submit" value="Scan 🔎" />
</form>

<div id="progress" hidden>
    <div class="sk-circle">
        <div class="sk-circle1 sk-child"></div>
        <div class="sk-circle2 sk-child"></div>
        <div class="sk-circle3 sk-child"></div>
        <div class="sk-circle4 sk-child"></div>
        <div class="sk-circle5 sk-child"></div>
        <div class="sk-circle6 sk-child"></div>
        <div class="sk-circle7 sk-child"></div>
        <div class="sk-circle8 sk-child"></div>
        <div class="sk-circle9 sk-child"></div>
        <div class="sk-circle10 sk-child"></div>
        <div class="sk-circle11 sk-child"></div>
        <div class="sk-circle12 sk-child"></div>
    </div>
</div>

<div id="result" style="margin-top:15px" hidden>
    @*<img id="preprocessed-image" class="col-md-6" />*@

    <button class="btn btn-primary btn-lg col-12" style="margin: auto" onclick="again()">👈 Back</button>

    <div style="height:10px; clear:both"></div>

    <div id="output-text" dir="rtl"
         style="white-space: pre-wrap; overflow-y: auto; text-align: right; background-color: whitesmoke; padding: 20px; "></div>

    <div style="height:10px; clear:both"></div>

</div>

<script>

    function again() {
        location.reload();
    }

    async function AJAXSubmit(oFormElement) {
        const formData = new FormData(oFormElement);

        try {
            oFormElement.setAttribute("hidden", "true");

            let progress = document.getElementById("progress");
            progress.removeAttribute("hidden");

            const response = await fetch(oFormElement.action, {
                method: 'POST',
                body: formData
            });

            let body = await response.json();

            let output = document.getElementById("output-text");
            output.textContent = body.output;

            progress.setAttribute("hidden", "true");

            let result = document.getElementById("result");
            result.removeAttribute("hidden");

        } catch (error) {
            console.error('Error:', error);
        }
    }
</script>